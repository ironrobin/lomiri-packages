From 8285cb9abe8a5e02a5003535b005e7fe6d1b3cd2 Mon Sep 17 00:00:00 2001
From: Alex R <alex@ironrobin.net>
Date: Mon, 13 Oct 2025 18:49:46 +0000
Subject: [PATCH] add qt5mir2server

---
 src/platforms/mirserver/CMakeLists.txt       | 13 +++++++++++++
 src/platforms/mirserver/qt5mir2server.pc.in~ | 12 ++++++++++++
 2 files changed, 25 insertions(+)
 create mode 100644 src/platforms/mirserver/qt5mir2server.pc.in~

diff --git a/src/platforms/mirserver/CMakeLists.txt b/src/platforms/mirserver/CMakeLists.txt
index 2615ea07..19a7f637 100644
--- a/src/platforms/mirserver/CMakeLists.txt
+++ b/src/platforms/mirserver/CMakeLists.txt
@@ -242,6 +242,19 @@ configure_file(${CMAKE_CURRENT_SOURCE_DIR}/qtmirserver.pc.in
     @ONLY
 )
 
+# Provide compatibility pkg-config name expected by Lomiri when building against Mir 2.x
+if (WITH_MIR2)
+  configure_file(
+    ${CMAKE_CURRENT_SOURCE_DIR}/qt5mir2server.pc.in
+    ${CMAKE_CURRENT_BINARY_DIR}/qt5mir2server.pc
+    @ONLY
+  )
+  install(
+    FILES ${CMAKE_CURRENT_BINARY_DIR}/qt5mir2server.pc
+    DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig
+  )
+endif()
+
 install(
   TARGETS qtmirserver
   LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
diff --git a/src/platforms/mirserver/qt5mir2server.pc.in~ b/src/platforms/mirserver/qt5mir2server.pc.in~
new file mode 100644
index 00000000..0ef4dfba
--- /dev/null
+++ b/src/platforms/mirserver/qt5mir2server.pc.in~
@@ -0,0 +1,12 @@
+prefix=@CMAKE_INSTALL_PREFIX@
+exec_prefix=${prefix}
+libdir=@LIBDIR@
+includedir=@INCLUDEDIR@
+
+Name: qt5mir2server
+Description: QtMir server library (built against Mir 2.x)
+Version: @QTMIR_VERSION@
+# Keep it simple: consumers get include & link to qtmirserver, which carries its own deps
+Requires: qtmirserver
+Libs: -L${libdir} -lqtmirserver
+Cflags: -I${includedir}
